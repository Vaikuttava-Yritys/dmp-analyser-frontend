<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Minimal DMP API Test</title>
</head>
<body>
  <h1>Minimal DMP API Test</h1>
  <pre id="output">Loadingâ€¦</pre>

  <script>
    // Minimal example - direct implementation without dependencies
    (async function() {
      const out = document.getElementById('output');
      
      // Configuration - normally would be loaded from .env
      const AUTH_PROXY_URL = 'https://dmp-token-proxy.azurewebsites.net';
      const AUTH_PROXY_TOKEN_ENDPOINT = '/token';
      
      try {
        // 1) Fetch a token from the auth proxy
        out.textContent = 'Requesting token...\n';
        const tokenResp = await fetch(`${AUTH_PROXY_URL}${AUTH_PROXY_TOKEN_ENDPOINT}`);
        
        if (!tokenResp.ok) {
          throw new Error(`Token proxy error ${tokenResp.status}: ${await tokenResp.text()}`);
        }
        
        const { access_token } = await tokenResp.json();
        out.textContent += 'Token acquired, calling API...\n\n';
        
        // 2) Call the APIM endpoint with the token
        const apiResp = await fetch('https://dmp-apim.azure-api.net/api/dmp/prompts', {
          headers: { 
            'Authorization': `Bearer ${access_token}`,
            'Content-Type': 'application/json'
          }
        });
        
        out.textContent += `API status: ${apiResp.status}\n\n`;
        
        // 3) Show response body
        if (apiResp.headers.get('content-type')?.includes('application/json')) {
          const data = await apiResp.json();
          out.textContent += JSON.stringify(data, null, 2);
        } else {
          const text = await apiResp.text();
          out.textContent += text;
        }
      } catch (e) {
        out.textContent = 'ERROR:\n' + e.message;
        console.error(e);
      }
    })();
  </script>
</body>
</html>
